Clean Architecture with .NET (C#), ASP.NET Core and Entity Framework

Databases: PostgreSQL, MySQL, SQL Server, Oracle

Clean Architecture helps you build maintainable, testable, and scalable enterprise applications by separating concerns and enforcing dependency rules.

1Ô∏è‚É£ What is Clean Architecture?

Clean Architecture (popularized by Robert C. Martin) organizes code into layers where:

Core business logic is independent

Frameworks & databases are external

Dependencies always point inward

2Ô∏è‚É£ Layered Structure in .NET

Typical project structure in ASP.NET Core:

Solution
 ‚îú‚îÄ‚îÄ Domain
 ‚îú‚îÄ‚îÄ Application
 ‚îú‚îÄ‚îÄ Infrastructure
 ‚îî‚îÄ‚îÄ WebAPI (Presentation)

üü¢ 1. Domain Layer (Core)

Entities

Value Objects

Domain Events

Interfaces (Repository contracts)

‚ö° No dependency on ASP.NET Core, EF, or database.

Example:

public class Order
{
    public Guid Id { get; private set; }
    public decimal TotalAmount { get; private set; }

    public void UpdateAmount(decimal amount)
    {
        if (amount <= 0)
            throw new ArgumentException("Amount must be positive");

        TotalAmount = amount;
    }
}

üîµ 2. Application Layer

Use Cases

DTOs

Interfaces (Repository, Unit of Work)

Business Rules

Example:

public interface IOrderRepository
{
    Task<Order> GetByIdAsync(Guid id);
    Task AddAsync(Order order);
}

üü° 3. Infrastructure Layer

Implements:

Entity Framework Core

Database providers

External services

Uses:

Entity Framework Core

Example:

public class OrderRepository : IOrderRepository
{
    private readonly AppDbContext _context;

    public OrderRepository(AppDbContext context)
    {
        _context = context;
    }

    public async Task<Order> GetByIdAsync(Guid id)
        => await _context.Orders.FindAsync(id);

    public async Task AddAsync(Order order)
        => await _context.Orders.AddAsync(order);
}

üî¥ 4. Presentation Layer (WebAPI)

Uses:

ASP.NET Core

Example Controller:

[ApiController]
[Route("api/orders")]
public class OrdersController : ControllerBase
{
    private readonly IOrderRepository _repository;

    public OrdersController(IOrderRepository repository)
    {
        _repository = repository;
    }

    [HttpGet("{id}")]
    public async Task<IActionResult> Get(Guid id)
    {
        var order = await _repository.GetByIdAsync(id);
        return Ok(order);
    }
}

3Ô∏è‚É£ Entity Framework Core (ORM)

Entity Framework Core supports multiple database providers:

Database	EF Core Provider
PostgreSQL	Npgsql
MySQL	Pomelo / Oracle provider
Microsoft SQL Server	Microsoft Provider
Oracle Database	Oracle EF Core provider
4Ô∏è‚É£ Database Configuration Example
SQL Server
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseSqlServer(configuration.GetConnectionString("Default")));

PostgreSQL
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseNpgsql(configuration.GetConnectionString("Default")));

MySQL
builder.Services.AddDbContext<AppDbContext>(options =>
    options.UseMySql(connectionString, ServerVersion.AutoDetect(connectionString)));

5Ô∏è‚É£ Dependency Rule (Most Important)
WebAPI  ‚Üí  Application  ‚Üí  Domain
Infrastructure ‚Üí Application & Domain


‚úî Domain never depends on EF
‚úî Application never depends on ASP.NET
‚úî Infrastructure depends on everything
‚úî Presentation depends only on Application

6Ô∏è‚É£ Benefits

‚úÖ Testable (mock repositories)

‚úÖ Database-agnostic

‚úÖ Scalable for microservices

‚úÖ Clear separation of concerns

‚úÖ Easy to swap databases

7Ô∏è‚É£ Advanced Best Practices

Use CQRS pattern

Use MediatR for request handling

Apply FluentValidation

Use Unit of Work

Implement Repository Pattern carefully (avoid over-abstraction)

Use Migrations per environment

Use Docker for database isolation

8Ô∏è‚É£ When Using Different Databases
PostgreSQL

Strong JSON support

Great for analytics workloads

MySQL

Lightweight & widely used

SQL Server

Best integration with .NET ecosystem

Oracle

Enterprise-grade systems

9Ô∏è‚É£ Typical Enterprise Architecture Stack

ASP.NET Core Web API

EF Core

Clean Architecture

PostgreSQL / SQL Server

Docker

Azure / AWS hosting

CI/CD (GitHub Actions / Azure DevOps)